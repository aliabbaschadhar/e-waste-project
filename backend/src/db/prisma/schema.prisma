generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum UserRole {
  USER
  RESTAURANT
  ADMIN
}

enum FoodStatus {
  AVAILABLE
  RESERVED
  CLAIMED
  EXPIRED
}

enum RequestStatus {
  PENDING
  APPROVED
  REJECTED
  COMPLETED
  CANCELLED
}

model User {
  id         String   @id @default(uuid())
  email      String   @unique
  password   String
  name       String
  phone      String?
  role       UserRole @default(USER)
  address    String?
  isVerified Boolean  @default(false)
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // Relations
  restaurant    Restaurant?
  foodRequests  FoodRequest[]
  notifications Notification[]

  @@map("users")
}

model Restaurant {
  id              String   @id @default(uuid())
  userId          String   @unique
  restaurantName  String
  description     String?
  address         String
  latitude        Float?
  longitude       Float?
  phone           String
  businessLicense String?
  rating          Float    @default(0)
  totalRatings    Int      @default(0)
  isVerified      Boolean  @default(false)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  foodListings FoodListing[]

  @@map("restaurants")
}

model FoodListing {
  id           String     @id @default(uuid())
  restaurantId String
  title        String
  description  String
  quantity     Int
  unit         String // kg, plates, servings, etc
  expiryDate   DateTime
  pickupTime   String // e.g., "5:00 PM - 8:00 PM"
  status       FoodStatus @default(AVAILABLE)
  imageUrl     String?
  category     String? // prepared food, raw ingredients, bakery, etc
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt

  // Relations
  restaurant   Restaurant    @relation(fields: [restaurantId], references: [id], onDelete: Cascade)
  foodRequests FoodRequest[]

  @@map("food_listings")
}

model FoodRequest {
  id            String        @id @default(uuid())
  userId        String
  foodListingId String
  quantity      Int
  message       String?
  status        RequestStatus @default(PENDING)
  pickupDate    DateTime?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  // Relations
  user        User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  foodListing FoodListing @relation(fields: [foodListingId], references: [id], onDelete: Cascade)

  @@map("food_requests")
}

model Notification {
  id        String   @id @default(uuid())
  userId    String
  title     String
  message   String
  isRead    Boolean  @default(false)
  type      String // request_approved, request_rejected, new_food_available, etc
  createdAt DateTime @default(now())

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("notifications")
}
